<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ניהול פתרונות למידה (GitHub JSON Editor)</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f6ff;
      margin: 2em;
    }
    h2 {
      color: #2b4c8a;
    }
    input, textarea {
      width: 100%;
      padding: 0.6em;
      margin-bottom: 1em;
    }
    button {
      background: #2b4c8a;
      color: white;
      padding: 0.6em 1.2em;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    .readonly {
      background: #eee;
      color: #666;
    }
    .section {
      background: #fff;
      padding: 1.5em;
      margin-bottom: 2em;
      border-radius: 10px;
      box-shadow: 0 0 5px #ccc;
    }
  </style>
</head>
<body>

  <h2>🧩 ממשק ניהול פתרונות למידה (GitHub JSON Editor)</h2>

  <div class="section">
    <label>👤 שם משתמש ב־GitHub:</label>
    <input type="text" id="username" value="maherkhatib77">

    <label>📁 שם הריפו:</label>
    <input type="text" id="repo" class="readonly" value="EduCatalog" readonly>

    <label>🗂️ שם הקובץ (JSON):</label>
    <input type="text" id="filename" value="solutions.json">

    <label>🔐 GitHub Token:</label>
    <input type="password" id="token">

    <button onclick="loadJson()">📥 טען קובץ JSON מ־GitHub</button>
  </div>

  <div class="section">
    <label>📝 ערוך את תוכן ה־JSON</label>
    <textarea id="jsonContent" rows="20" placeholder="כאן יופיע התוכן..."></textarea>
    <button onclick="saveJson()">💾 שמור ל־GitHub (Commit)</button>
    <p id="statusMsg"></p>
  </div>

  <script>
    async function loadJson() {
      const username = document.getElementById("username").value;
      const repo = document.getElementById("repo").value;
      const filename = document.getElementById("filename").value;
      const token = document.getElementById("token").value;

      const url = `https://api.github.com/repos/${username}/${repo}/contents/${filename}`;

      try {
        const res = await fetch(url, {
          headers: { Authorization: `token ${token}` }
        });
        if (!res.ok) throw new Error("שגיאה בטעינה מה־GitHub");
        const data = await res.json();
        const content = atob(data.content);
        document.getElementById("jsonContent").value = content;
        document.getElementById("statusMsg").textContent = "✅ נטען בהצלחה.";
      } catch (err) {
        document.getElementById("statusMsg").textContent = "❌ שגיאה בטעינת הקובץ.";
      }
    }

    async function saveJson() {
      const username = document.getElementById("username").value;
      const repo = document.getElementById("repo").value;
      const filename = document.getElementById("filename").value;
      const token = document.getElementById("token").value;
      const content = btoa(unescape(encodeURIComponent(document.getElementById("jsonContent").value)));
      const url = `https://api.github.com/repos/${username}/${repo}/contents/${filename}`;

      try {
        // Get the SHA of the current file
        const res = await fetch(url, {
          headers: { Authorization: `token ${token}` }
        });
        const data = await res.json();
        const sha = data.sha;

        const update = await fetch(url, {
          method: "PUT",
          headers: {
            Authorization: `token ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "עדכון JSON אוטומטי מ־dashboard",
            content: content,
            sha: sha
          })
        });

        if (!update.ok) throw new Error("שגיאה בעדכון הקובץ");
        document.getElementById("statusMsg").textContent = "✅ הקובץ עודכן בהצלחה.";
      } catch (err) {
        document.getElementById("statusMsg").textContent = "❌ שגיאה בשמירת הקובץ.";
      }
    }
  </script>

</body>
</html>
