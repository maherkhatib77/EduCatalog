<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ניהול פתרונות למידה</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>📂 ניהול פתרונות למידה</h2>
  <table id="solutionsTable">
    <thead>
      <tr>
        <th>מזהה</th>
        <th>שם</th>
        <th>מרצה</th>
        <th>שעות</th>
        <th>תמונה</th>
        <th>מחיקה</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="addNew()">➕ הוסף חדש</button>
  <button onclick="saveToGitHub()">💾 שמור ל־GitHub</button>
  <p id="status"></p>

  <script>
    const username = "maherkhatib77";
    const repo = "EduCatalog";
    const path = "solutions.json";
    const token = "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";
    let sha = "";
    let data = [];

    function loadData() {
      fetch(`https://api.github.com/repos/\${username}/\${repo}/contents/\${path}`, {
        headers: { Authorization: `token \${token}` }
      })
      .then(res => res.json())
      .then(json => {
        sha = json.sha;
        data = JSON.parse(atob(json.content));
        renderTable();
      });
    }

    function renderTable() {
      const tbody = document.querySelector("#solutionsTable tbody");
      tbody.innerHTML = "";
      data.forEach((item, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><input value="\${item.id}" onchange="data[\${i}].id=this.value"></td>
          <td><input value="\${item.title}" onchange="data[\${i}].title=this.value"></td>
          <td><input value="\${item.instructor}" onchange="data[\${i}].instructor=this.value"></td>
          <td><input type="number" value="\${item.hours}" onchange="data[\${i}].hours=parseInt(this.value)"></td>
          <td><input value="\${item.image}" onchange="data[\${i}].image=this.value"></td>
          <td><button onclick="deleteRow(\${i})">🗑️</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    function addNew() {
      data.push({ id: "", title: "", instructor: "", hours: 0, image: "" });
      renderTable();
    }

    function deleteRow(i) {
      data.splice(i, 1);
      renderTable();
    }

    function saveToGitHub() {
      const content = btoa(JSON.stringify(data, null, 2));
      fetch(`https://api.github.com/repos/\${username}/\${repo}/contents/\${path}`, {
        method: "PUT",
        headers: {
          Authorization: `token \${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "עדכון קובץ solutions.json",
          content: content,
          sha: sha
        })
      })
      .then(res => res.json())
      .then(result => {
        document.getElementById("status").textContent = "✅ נשמר בהצלחה.";
        sha = result.content.sha;
      })
      .catch(() => {
        document.getElementById("status").textContent = "❌ שגיאה בשמירה.";
      });
    }

    loadData();
  </script>
</body>
</html>
