
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>מערכת ניהול EduCatalog</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="../modules.js"></script>
</head>
<body class="bg-gray-100 text-gray-900">

  <header class="bg-blue-900 text-white p-4 text-center text-2xl font-bold">
    מערכת ניהול פתרונות למידה
  </header>

  <main class="p-6 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
    <!-- כפתורי מודולים -->
    <button class="bg-white rounded-lg shadow p-4 flex items-center gap-3 hover:bg-blue-50"
            onclick="openModule('mentors')">
      <span>👨‍🏫 מנחים</span>
    </button>

    <button class="bg-white rounded-lg shadow p-4 flex items-center gap-3 hover:bg-blue-50"
            onclick="openModule('guides')">
      <span>📘 מדריכים פדגוגיים</span>
    </button>

    <button class="bg-white rounded-lg shadow p-4 flex items-center gap-3 hover:bg-blue-50"
            onclick="openModule('learning_types')">
      <span>💻 אופני למידה</span>
    </button>

    <button class="bg-white rounded-lg shadow p-4 flex items-center gap-3 hover:bg-blue-50"
            onclick="openModule('days')">
      <span>📅 ימי מפגש</span>
    </button>

    <button class="bg-white rounded-lg shadow p-4 flex items-center gap-3 hover:bg-blue-50"
            onclick="openModule('stages')">
      <span>🏫 שלבי חינוך</span>
    </button>

    <button class="bg-white rounded-lg shadow p-4 flex items-center gap-3 hover:bg-blue-50"
            onclick="openModule('categories')">
      <span>📂 תחומי פתרונות למידה</span>
    </button>

    <button class="bg-white rounded-lg shadow p-4 flex items-center gap-3 hover:bg-blue-50"
            onclick="openModule('subjects')">
      <span>📚 תחומי דעת</span>
    </button>

    <button class="bg-white rounded-lg shadow p-4 flex items-center gap-3 hover:bg-blue-50"
            onclick="openModule('site_info')">
      <span>🌐 מידע כללי לאתר</span>
    </button>

    <button class="bg-white rounded-lg shadow p-4 flex items-center gap-3 hover:bg-blue-50"
            onclick="openModule('credits')">
      <span>🕒 היקף שעות מוכר</span>
    </button>

    <button class="bg-white rounded-lg shadow p-4 flex items-center gap-3 hover:bg-blue-50"
            onclick="openModule('solutions')">
      <span>🧩 פתרונות למידה</span>
    </button>
  </main>

  <!-- אזור דינמי לכל מודול -->
  <section id="module-container" class="p-6">
    <div id="mentors">
<input type="text" placeholder="🔍 חיפוש..." 
       oninput="filterCards('mentors', this.value)"
       class="border rounded px-2 py-1 mb-2 w-full">

<button onclick="loadAndExport('mentors', 'mentors')"
        class="bg-blue-600 text-white rounded px-4 py-2 mt-2 ml-2">
  📤 ייצוא ל-Excel
</button>

<button onclick="importExcelToModule('mentors', addMentor)"
        class="bg-green-600 text-white rounded px-4 py-2 mt-2 mb-4">
  📥 ייבוא מקובץ Excel
</button>
</div>
    <div id="guides">
<input type="text" placeholder="🔍 חיפוש..." 
       oninput="filterCards('guides', this.value)"
       class="border rounded px-2 py-1 mb-2 w-full">

<button onclick="loadAndExport('guides', 'guides')"
        class="bg-blue-600 text-white rounded px-4 py-2 mt-2 ml-2">
  📤 ייצוא ל-Excel
</button>

<button onclick="importExcelToModule('guides', addGuide)"
        class="bg-green-600 text-white rounded px-4 py-2 mt-2 mb-4">
  📥 ייבוא מקובץ Excel
</button>
</div>
    <div id="learning_types">
<input type="text" placeholder="🔍 חיפוש..." 
       oninput="filterCards('learning_types', this.value)"
       class="border rounded px-2 py-1 mb-2 w-full">

<button onclick="loadAndExport('learning_types', 'learning_types')"
        class="bg-blue-600 text-white rounded px-4 py-2 mt-2 ml-2">
  📤 ייצוא ל-Excel
</button>

<button onclick="importExcelToModule('learning_types', addLearningType)"
        class="bg-green-600 text-white rounded px-4 py-2 mt-2 mb-4">
  📥 ייבוא מקובץ Excel
</button>
</div>
    <div id="days">
<input type="text" placeholder="🔍 חיפוש..." 
       oninput="filterCards('days', this.value)"
       class="border rounded px-2 py-1 mb-2 w-full">

<button onclick="loadAndExport('days', 'days')"
        class="bg-blue-600 text-white rounded px-4 py-2 mt-2 ml-2">
  📤 ייצוא ל-Excel
</button>

<button onclick="importExcelToModule('days', addDay)"
        class="bg-green-600 text-white rounded px-4 py-2 mt-2 mb-4">
  📥 ייבוא מקובץ Excel
</button>
</div>
    <div id="stages">
<input type="text" placeholder="🔍 חיפוש..." 
       oninput="filterCards('stages', this.value)"
       class="border rounded px-2 py-1 mb-2 w-full">

<button onclick="loadAndExport('stages', 'stages')"
        class="bg-blue-600 text-white rounded px-4 py-2 mt-2 ml-2">
  📤 ייצוא ל-Excel
</button>

<button onclick="importExcelToModule('stages', addStage)"
        class="bg-green-600 text-white rounded px-4 py-2 mt-2 mb-4">
  📥 ייבוא מקובץ Excel
</button>
</div>
    <div id="categories">
<input type="text" placeholder="🔍 חיפוש..." 
       oninput="filterCards('categories', this.value)"
       class="border rounded px-2 py-1 mb-2 w-full">

<button onclick="loadAndExport('categories', 'categories')"
        class="bg-blue-600 text-white rounded px-4 py-2 mt-2 ml-2">
  📤 ייצוא ל-Excel
</button>

<button onclick="importExcelToModule('categories', addCategory)"
        class="bg-green-600 text-white rounded px-4 py-2 mt-2 mb-4">
  📥 ייבוא מקובץ Excel
</button>
</div>
    <div id="subjects">
<input type="text" placeholder="🔍 חיפוש..." 
       oninput="filterCards('subjects', this.value)"
       class="border rounded px-2 py-1 mb-2 w-full">

<button onclick="loadAndExport('subjects', 'subjects')"
        class="bg-blue-600 text-white rounded px-4 py-2 mt-2 ml-2">
  📤 ייצוא ל-Excel
</button>

<button onclick="importExcelToModule('subjects', addSubject)"
        class="bg-green-600 text-white rounded px-4 py-2 mt-2 mb-4">
  📥 ייבוא מקובץ Excel
</button>
</div>
    <div id="site_info">
<input type="text" placeholder="🔍 חיפוש..." 
       oninput="filterCards('site_info', this.value)"
       class="border rounded px-2 py-1 mb-2 w-full">

<button onclick="loadAndExport('site_info', 'site_info')"
        class="bg-blue-600 text-white rounded px-4 py-2 mt-2 ml-2">
  📤 ייצוא ל-Excel
</button>

<button onclick="importExcelToModule('site_info', addSiteInfo)"
        class="bg-green-600 text-white rounded px-4 py-2 mt-2 mb-4">
  📥 ייבוא מקובץ Excel
</button>
</div>
    <div id="credits">
<input type="text" placeholder="🔍 חיפוש..." 
       oninput="filterCards('credits', this.value)"
       class="border rounded px-2 py-1 mb-2 w-full">

<button onclick="loadAndExport('credits', 'credits')"
        class="bg-blue-600 text-white rounded px-4 py-2 mt-2 ml-2">
  📤 ייצוא ל-Excel
</button>

<button onclick="importExcelToModule('credits', addCredit)"
        class="bg-green-600 text-white rounded px-4 py-2 mt-2 mb-4">
  📥 ייבוא מקובץ Excel
</button>
</div>
    <div id="solutions">
<input type="text" placeholder="🔍 חיפוש..." 
       oninput="filterCards('solutions', this.value)"
       class="border rounded px-2 py-1 mb-2 w-full">

<button onclick="loadAndExport('solutions', 'solutions')"
        class="bg-blue-600 text-white rounded px-4 py-2 mt-2 ml-2">
  📤 ייצוא ל-Excel
</button>

<button onclick="importExcelToModule('solutions', addSolution)"
        class="bg-green-600 text-white rounded px-4 py-2 mt-2 mb-4">
  📥 ייבוא מקובץ Excel
</button>
</div>
  </section>

  <script type="module">
    import {
      createMentorsForm, loadMentors, renderMentors, addMentor,
      createGuidesForm, loadGuides, renderGuides, addGuide,
      createLearningTypesForm, loadLearningTypes, renderLearningTypes, addLearningType,
      createDaysForm, loadDays, renderDays, addDay,
      createStagesForm, loadStages, renderStages, addStage,
      createCategoriesForm, loadCategories, renderCategories, addCategory,
      createSubjectsForm, loadSubjects, renderSubjects, addSubject,
      createSiteInfoForm, loadSiteInfo, renderSiteInfo, addSiteInfo,
      createCreditsForm, loadCredits, renderCredits, addCredit,
      createSolutionsForm, loadSolutions, renderSolutions, addSolution
    } from "../modules.js";

    const modules = {
      mentors: () => {
        createMentorsForm('mentors', addMentor);
        loadMentors(data => renderMentors('mentors', data));
      },
      guides: () => {
        createGuidesForm('guides', addGuide);
        loadGuides(data => renderGuides('guides', data));
      },
      learning_types: () => {
        createLearningTypesForm('learning_types', addLearningType);
        loadLearningTypes(data => renderLearningTypes('learning_types', data));
      },
      days: () => {
        createDaysForm('days', addDay);
        loadDays(data => renderDays('days', data));
      },
      stages: () => {
        createStagesForm('stages', addStage);
        loadStages(data => renderStages('stages', data));
      },
      categories: () => {
        createCategoriesForm('categories', addCategory);
        loadCategories(data => renderCategories('categories', data));
      },
      subjects: () => {
        createSubjectsForm('subjects', addSubject);
        loadSubjects(data => renderSubjects('subjects', data));
      },
      site_info: () => {
        createSiteInfoForm('site_info', addSiteInfo);
        loadSiteInfo(data => renderSiteInfo('site_info', data));
      },
      credits: () => {
        createCreditsForm('credits', addCredit);
        loadCredits(data => renderCredits('credits', data));
      },
      solutions: () => {
        createSolutionsForm('solutions', addSolution);
        loadSolutions(data => renderSolutions('solutions', data));
      },
    };

    window.openModule = function (id) {
      // הסתר את כל המודולים
      document.querySelectorAll('#module-container > div').forEach(div => div.innerHTML = '');
      // טען את המודול הרצוי
      modules[id]();
    }
  </script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
  // פונקציה כללית ליבוא אקסל לכל מודול לפי שם שדה בסיסי
  function importExcelToModule(moduleId, addFunction) {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.xlsx,.xls';
    input.onchange = (e) => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = (evt) => {
        const data = new Uint8Array(evt.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet);
        json.forEach(row => addFunction(row));
        alert('ייבוא הסתיים בהצלחה!');
      };
      reader.readAsArrayBuffer(file);
    };
    input.click();
  }
</script>


<script>
  function exportDataToExcel(data, filename) {
    const ws = XLSX.utils.json_to_sheet(Object.values(data));
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Data");
    XLSX.writeFile(wb, filename + ".xlsx");
  }
</script>


<script>
  function loadAndExport(path, filename) {
    import('./modules.js').then(module => {
      const db = module.db;
      import("https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js").then(() => {
        import("https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js").then(() => {
          import("https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js").then(() => {
            module.loadDataOnce(path).then(data => {
              exportDataToExcel(data || {}, filename);
            });
          });
        });
      });
    });
  }
</script>


<script>
function filterCards(containerId, searchText) {
  const cards = document.querySelectorAll('#' + containerId + ' .card');
  searchText = searchText.toLowerCase();
  cards.forEach(card => {
    const content = card.textContent.toLowerCase();
    card.style.display = content.includes(searchText) ? '' : 'none';
  });
}
</script>

</body>
</html>
